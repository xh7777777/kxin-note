# 开发日志

## 2024年6月8日 - UI布局与组件框架实现

### 🎨 主要工作内容

#### 1. 主页面布局设计与实现

- **完成MainPage.vue主页面结构**
  - 实现左右分栏布局设计
  - 左侧280px固定宽度侧边栏
  - 右侧自适应内容区域
  - 添加响应式媒体查询支持

#### 2. 侧边栏组件开发 (SideBar.vue)

- **基础功能实现**

  - 搜索框组件 (带快捷键提示 `/`)
  - Features功能区域 (Home、My Pageshelf)
  - NotePages笔记列表区域
  - 底部工具栏 (暗黑模式、设置、垃圾桶)

- **交互功能**
  - 可展开/收缩的区域设计
  - 笔记列表滚动和选中状态
  - 悬停效果和过渡动画
  - 本地存储状态持久化

#### 3. 样式系统优化

- **Tailwind CSS集成深化**
  - 自定义滚动条样式 (`.scrollbar-thin`)
  - 响应式断点设计
  - 动画过渡效果统一
  - 颜色主题系统建立

#### 4. 组件通信机制

- **父子组件事件系统**
  - `@add-note`, `@select-note` 等事件定义
  - props数据流向设计
  - 状态管理模式确立

### 🐛 遇到的问题与解决方案

#### 问题1: 侧边栏滚动区域高度计算

- **问题**: 动态内容高度计算不准确
- **解决**: 使用`nextTick`和`scrollHeight`动态计算
- **代码**: 实现`calculateContentHeight`函数

#### 问题2: CSS作用域和样式冲突

- **问题**: 全局样式和组件样式冲突
- **解决**: 使用scoped CSS + Tailwind工具类组合
- **优化**: 建立统一的样式规范

### 📋 技术决策

#### 1. 布局方案选择

- **采用**: Flexbox + Fixed定位
- **理由**: 简单可靠，兼容性好
- **替代**: Grid布局 (过于复杂)

#### 2. 状态管理方案

- **采用**: Vue Composition API + 局部状态
- **理由**: 项目规模适中，无需Pinia
- **后续**: 复杂度增加时考虑引入状态管理库

### 🎯 后续计划

- [ ] 笔记编辑器组件开发 (NoteView.vue)
- [ ] 笔记数据结构设计
- [ ] IPC通信机制完善

---

## 2024年6月7日 - 笔记接口开发

### 🚀 主要工作内容

#### 1. 笔记接口功能

- **IPC通道定义**: 在 `src/preload/index.ts` 中，通过 `contextBridge` 暴露了 `noteAPI`，定义了包括创建、读取、更新、删除、归档、收藏笔记等10余个IPC调用事件，如 `note:create`, `notes:getAll` 等。
- **主进程实现**: 在 `src/main/hooks/note-action-hook.ts` 中，实现了所有 `noteAPI` 的后端逻辑。
- **数据存储**:
  - 每篇笔记以独立的 `JSON` 文件形式存储在用户数据目录的 `notes` 文件夹下。
  - 设计并实现了笔记索引系统 (`notes-index.json`)，用于存储所有笔记的元数据，如ID、标题、父节点、层级和收藏状态等，以优化笔记列表的加载速度。
- **核心功能**:
  - `createNote`: 创建新的笔记JSON文件和索引。
  - `getAllNotes`: 读取索引文件，快速返回所有笔记的列表信息。
  - `updateNote`: 更新指定笔记的JSON文件内容和索引。
  - `deleteNote`: 从文件系统和索引中彻底删除笔记。
  - `moveToTrash`, `archiveNote`, `toggleFavorite`: 修改笔记状态，并更新索引文件。

#### 2. 数据模型设计

- 在 `src/common/models/note.types.ts` 中定义了整个笔记系统所需的数据结构。
- `NotePage` 接口: 定义了笔记页面的完整结构，包括ID、标题、图标、内容、父子关系、层级等。
- `NoteContent` 与 `NoteBlock`: 定义了笔记内容的结构，为后续集成Editor.js做准备。
- `NoteIndex` 与 `NoteIndexItem`: 定义了笔记索引文件和索引项的结构，确保类型安全和数据一致性。

#### 3. 单元测试

- **测试覆盖**: 针对 `src/main/hooks/note-action-hook.ts` 中的核心功能，在 `tests/main/note-action-hook.spec.ts` 中编写了全面的单元测试。
- **测试内容**: 覆盖了笔记的创建、读取、更新、删除、移动到回收站、归档等所有API的正常和异常流程。
- **Mocking**: 使用 `fs/promises` 的mock来模拟文件系统操作，确保测试的独立性和速度。

### 🎯 后续计划

- [ ] Electron复制粘贴功能

## 2024年6月9日 - Editor.js插件引入与复制粘贴补充

### 🚀 主要工作内容

#### 1. 自定义菜单与原生功能集成

- **完善应用菜单**: 在 `src/main/hooks/menu-hook.ts` 中，通过 `Menu.buildFromTemplate` API 构建了跨平台的原生应用菜单。
- **集成原生Role**: 为菜单项（如“快速重启”、“开发者工具”）分配了Electron内置的 `role` 属性（如 `reload`, `toggleDevTools`），从而实现了无需手动编写事件处理逻辑的原生功能，如**复制、粘贴、剪切、全选**等标准的编辑操作也因此得到了默认支持。

#### 2. 引入并配置Editor.js核心插件

- **初始化Editor.js**: 在 `src/renderer/views/main-page/hooks/useEdjtorJs.ts` 中，创建了 `useEditorJs` 组合式函数来封装和管理Editor.js实例。
- **集成基础插件**:
  - 引入了 `@editorjs/editorjs` 核心库。
  - 添加并配置了5个官方核心插件，以支持丰富的笔记内容：
    - `@editorjs/header`：支持多级标题。
    - `@editorjs/paragraph`：支持段落文本及内联工具栏。
    - `@editorjs/quote`：支持引用块。
    - `@editorjs/delimiter`：支持分割线。
    - `@editorjs/list`：支持有序和无序列表。
- **组件集成**: 在 `NoteView.vue` 组件中，调用 `useEditorJs` 来渲染编辑器，并通过 `props` 接收 `noteId` 来加载和切换不同的笔记内容。

### 🎯 后续计划

- [ ] 自定义菜单与样式
- [ ] markdown支持

## 2024年6月11日 - 内容保存与文件上传

- 内容保存
- 文件上传 attach插件

### 🎯 后续计划

- 动态基础块插件开发
- dnd功能
